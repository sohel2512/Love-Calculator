<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoveMeter Pro - Dark Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&amp;display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; }
        
        /* Animations & Effects */
        @keyframes float-up {
            0% { transform: translateY(0) scale(0.8); opacity: 0; }
            20% { opacity: 0.6; }
            100% { transform: translateY(-120vh) scale(1.2); opacity: 0; }
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(244, 63, 94, 0.2); transform: scale(1); }
            50% { box-shadow: 0 0 40px rgba(244, 63, 94, 0.5); transform: scale(1.02); }
        }
        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes starry-twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.5); }
        }

        .bg-animated-dark {
            background: linear-gradient(-45deg, #0f172a, #1e1b4b, #310b1e, #0f172a);
            background-size: 400% 400%;
            animation: gradient-shift 20s ease infinite;
        }

        .glass-panel-dark {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .input-dark-glow:focus-within {
            box-shadow: 0 0 0 2px rgba(244, 63, 94, 0.4);
            border-color: rgba(244, 63, 94, 0.6);
            background: rgba(255, 255, 255, 0.03);
        }

        .heart-particle {
            position: absolute;
            bottom: -20px;
            pointer-events: none;
            animation: float-up linear forwards;
            filter: drop-shadow(0 0 5px rgba(244,63,94,0.5));
        }

        .progress-circle {
            transition: stroke-dashoffset 2s cubic-bezier(0.2, 0.8, 0.2, 1);
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        .shake-error {
            animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        
        .shimmer-text {
            background: linear-gradient(to right, #fb7185 20%, #fff 50%, #fb7185 80%);
            background-size: 200% auto;
            color: transparent;
            background-clip: text;
            -webkit-background-clip: text;
            animation: gradient-shift 3s linear infinite;
        }

        /* Utility for transitions */
        .view-hidden {
            display: none !important;
        }
        .view-visible {
            display: flex !important;
            opacity: 1 !important;
        }
        .fade-out {
            opacity: 0;
            transform: scale(0.98);
        }
    </style>
</head>
<body class="bg-animated-dark text-slate-200 h-screen w-full overflow-hidden flex items-center justify-center relative selection:bg-rose-500/30 selection:text-rose-200">

    <!-- Ambient Background Effects -->
    <div id="stars-container" class="absolute inset-0 pointer-events-none z-0"></div>
    <div class="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(244,63,94,0.1),transparent_70%)] z-0 pointer-events-none"></div>
    <div id="particles" class="absolute inset-0 overflow-hidden pointer-events-none z-0"></div>

    <main class="w-full max-w-sm mx-auto p-4 relative z-10">
        
        <!-- Header -->
        <header class="flex justify-between items-center mb-6 px-2">
            <div class="flex items-center gap-3">
                <div class="relative">
                    <div class="absolute inset-0 bg-rose-500 blur-lg opacity-40 rounded-full"></div>
                    <div class="relative w-10 h-10 rounded-full bg-gradient-to-br from-rose-500 to-purple-600 flex items-center justify-center text-white border border-white/10">
                        <iconify-icon icon="solar:heart-angle-linear" width="22" stroke-width="2"></iconify-icon>
                    </div>
                </div>
                <div>
                    <h1 class="text-lg font-medium tracking-tight text-white">LoveMeter</h1>
                    <p class="text-[10px] text-rose-300 tracking-widest uppercase font-medium">Pro Edition</p>
                </div>
            </div>
            <button onclick="toggleAudio()" id="audio-btn" class="w-9 h-9 rounded-full bg-slate-800/50 hover:bg-slate-700/50 border border-white/5 flex items-center justify-center transition-all text-slate-400 hover:text-rose-400 backdrop-blur-md">
                <iconify-icon id="sound-icon" icon="solar:volume-cross-linear" width="18"></iconify-icon>
            </button>
        </header>

        <!-- View: Input Form -->
        <section id="input-view" class="glass-panel-dark rounded-3xl p-6 md:p-8 transition-all duration-500 border-t border-white/10 relative overflow-hidden group">
            <div class="absolute -top-20 -right-20 w-40 h-40 bg-rose-500/10 rounded-full blur-3xl pointer-events-none"></div>

            <div class="text-center mb-8 relative">
                <h2 class="text-xl font-medium tracking-tight text-white mb-2">Calculate Destiny</h2>
                <p class="text-xs text-slate-400 leading-relaxed max-w-[240px] mx-auto">Discover the cosmic potential of your relationship with our advanced love algorithm.</p>
            </div>

            <form id="love-form" class="space-y-5" onsubmit="handleCalculate(event)">
                <div class="space-y-1.5">
                    <label class="text-[10px] font-semibold text-rose-300 ml-1 uppercase tracking-wider">Your Name</label>
                    <div class="relative input-dark-glow rounded-2xl transition-all duration-300 bg-slate-900/50 border border-white/10 group-focus-within:border-rose-500/30">
                        <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none text-slate-500">
                            <iconify-icon icon="solar:user-circle-linear" width="20"></iconify-icon>
                        </div>
                        <input type="text" id="name1" class="block w-full pl-11 pr-4 py-3.5 rounded-2xl bg-transparent border-none focus:ring-0 text-white placeholder-slate-600 font-medium text-sm transition-colors" placeholder="Enter name..." autocomplete="off">
                    </div>
                </div>

                <div class="flex justify-center -my-3 relative z-10 opacity-60">
                    <div class="bg-slate-900 rounded-full p-1.5 border border-white/10 text-rose-500 shadow-lg shadow-black/20">
                        <iconify-icon icon="solar:infinity-linear" width="20"></iconify-icon>
                    </div>
                </div>

                <div class="space-y-1.5">
                    <label class="text-[10px] font-semibold text-rose-300 ml-1 uppercase tracking-wider">Partner's Name</label>
                    <div class="relative input-dark-glow rounded-2xl transition-all duration-300 bg-slate-900/50 border border-white/10 group-focus-within:border-rose-500/30">
                        <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none text-slate-500">
                            <iconify-icon icon="solar:heart-linear" width="20"></iconify-icon>
                        </div>
                        <input type="text" id="name2" class="block w-full pl-11 pr-4 py-3.5 rounded-2xl bg-transparent border-none focus:ring-0 text-white placeholder-slate-600 font-medium text-sm transition-colors" placeholder="Enter name..." autocomplete="off">
                    </div>
                </div>

                <div class="pt-4">
                    <button id="analyze-btn" type="submit" class="w-full relative overflow-hidden bg-gradient-to-r from-rose-600 to-purple-600 hover:from-rose-500 hover:to-purple-500 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:from-rose-600 disabled:hover:to-purple-600 text-white font-medium py-4 px-4 rounded-2xl shadow-xl shadow-rose-900/20 active:scale-[0.98] transition-all duration-300 group">
                        <div class="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>
                        <div class="relative flex items-center justify-center gap-2">
                            <span id="btn-text">Analyze Connection</span>
                            <iconify-icon id="btn-icon" icon="solar:stars-minimalistic-linear" width="18" class="animate-pulse"></iconify-icon>
                        </div>
                    </button>
                </div>
            </form>
        </section>

        <!-- View: Loading -->
        <section id="loading-view" class="hidden opacity-0 transition-opacity duration-500 glass-panel-dark rounded-3xl p-10 text-center flex-col items-center justify-center min-h-[360px]">
            <div class="relative w-28 h-28 mb-8">
                <div class="absolute inset-0 border-[3px] border-slate-700/30 rounded-full"></div>
                <div class="absolute inset-0 rounded-full border-[3px] border-transparent border-t-rose-500 border-l-purple-500 animate-[spin_1.5s_linear_infinite]"></div>
                <div class="absolute inset-0 flex items-center justify-center">
                    <div class="w-20 h-20 bg-rose-500/10 rounded-full flex items-center justify-center animate-[pulse-glow_2s_infinite]">
                        <iconify-icon icon="solar:heart-bold" width="36" class="text-rose-500 drop-shadow-[0_0_10px_rgba(244,63,94,0.8)]"></iconify-icon>
                    </div>
                </div>
            </div>
            
            <h3 class="text-lg font-medium text-white mb-2 shimmer-text">Consulting the Stars...</h3>
            <div class="h-6 overflow-hidden">
                <p id="loading-text" class="text-xs text-slate-400 font-medium tracking-wide uppercase transition-all duration-300">Aligning Constellations</p>
            </div>
        </section>

        <!-- View: Result -->
        <section id="result-view" class="hidden opacity-0 transition-opacity duration-700 flex-col gap-4">
            <div class="glass-panel-dark rounded-3xl p-6 relative overflow-hidden border-t border-white/10">
                <div class="absolute top-0 right-0 p-4 opacity-5 text-rose-500 pointer-events-none">
                    <iconify-icon icon="solar:heart-bold" width="140"></iconify-icon>
                </div>
                
                <div class="flex flex-col items-center text-center relative z-10">
                    <div class="flex items-center gap-2 mb-6 w-full justify-center">
                        <span id="res-name1" class="text-sm font-medium text-slate-200 truncate max-w-[40%]">Name</span>
                        <iconify-icon icon="solar:link-circle-linear" class="text-rose-500 shrink-0" width="16"></iconify-icon>
                        <span id="res-name2" class="text-sm font-medium text-slate-200 truncate max-w-[40%]">Name</span>
                    </div>

                    <div class="relative w-48 h-48 mb-6">
                        <svg class="w-full h-full transform -rotate-90 drop-shadow-[0_0_15px_rgba(225,29,72,0.3)]" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="42" fill="none" stroke="#1e293b" stroke-width="6" stroke-linecap="round"></circle>
                            <circle id="progress-circle" class="progress-circle" cx="50" cy="50" r="42" fill="none" stroke="url(#gradient)" stroke-width="6" stroke-linecap="round" stroke-dasharray="264" stroke-dashoffset="264"></circle>
                            <defs>
                                <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" stop-color="#f43f5e"></stop>
                                    <stop offset="100%" stop-color="#a855f7"></stop>
                                </linearGradient>
                            </defs>
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span id="score-counter" class="text-5xl font-semibold text-white tracking-tighter drop-shadow-lg">0%</span>
                            <span id="score-category" class="text-[10px] font-semibold text-rose-200 mt-2 px-3 py-1 rounded-full uppercase tracking-wider bg-rose-500/20 border border-rose-500/30">Calculating</span>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3 mt-2">
                    <div class="bg-slate-900/40 rounded-2xl p-3 border border-white/5 flex flex-col items-center gap-1">
                        <iconify-icon icon="solar:ring-linear" class="text-rose-400 mb-1" width="20"></iconify-icon>
                        <span class="text-[10px] text-slate-500 uppercase tracking-wider font-semibold">Marriage</span>
                        <span id="marriage-pred" class="text-xs font-medium text-slate-200">Processing...</span>
                    </div>
                    <div class="bg-slate-900/40 rounded-2xl p-3 border border-white/5 flex flex-col items-center gap-1">
                        <iconify-icon icon="solar:home-smile-linear" class="text-purple-400 mb-1" width="20"></iconify-icon>
                        <span class="text-[10px] text-slate-500 uppercase tracking-wider font-semibold">Family</span>
                        <span id="family-pred" class="text-xs font-medium text-slate-200">Processing...</span>
                    </div>
                </div>
            </div>

            <div class="glass-panel-dark rounded-2xl p-5 border-l-2 border-l-rose-500 bg-gradient-to-r from-rose-900/10 to-transparent">
                <div class="flex gap-4 items-start">
                    <iconify-icon icon="solar:quote-up-square-linear" width="24" class="text-rose-500 shrink-0 mt-0.5 opacity-80"></iconify-icon>
                    <p id="quote-text" class="text-xs text-slate-300 italic leading-relaxed font-light">"Love is composed of a single soul inhabiting two bodies."</p>
                </div>
            </div>

            <div class="flex gap-3 pt-2">
                <button onclick="resetApp()" class="flex-1 bg-slate-800 hover:bg-slate-700 text-slate-300 py-3.5 rounded-xl text-xs font-medium transition-all border border-white/5 uppercase tracking-wide">
                    Recalculate
                </button>
                <button onclick="shareResult()" class="flex-1 bg-rose-600 hover:bg-rose-500 text-white py-3.5 rounded-xl text-xs font-medium shadow-lg shadow-rose-900/40 transition-all flex items-center justify-center gap-2 uppercase tracking-wide border border-rose-400/20">
                    <iconify-icon icon="solar:share-linear" width="16"></iconify-icon>
                    Share
                </button>
            </div>
        </section>

    </main>

    <div id="toast" class="fixed top-8 left-1/2 transform -translate-x-1/2 bg-slate-800/90 backdrop-blur-md border border-emerald-500/30 text-emerald-400 px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 transition-all duration-500 opacity-0 translate-y-[-20px] pointer-events-none z-50">
        <div class="w-5 h-5 rounded-full bg-emerald-500/20 flex items-center justify-center">
            <iconify-icon icon="solar:check-circle-bold" width="14"></iconify-icon>
        </div>
        <span class="text-xs font-medium text-white tracking-wide">Copied to clipboard!</span>
    </div>

    <canvas id="confetti-canvas" class="absolute inset-0 w-full h-full pointer-events-none z-50"></canvas>

    <script>
        const state = {
            audioEnabled: false,
            audioCtx: null,
            name1: '',
            name2: '',
            isCalculating: false,
            simulationInterval: null,
            fallbackTimeout: null
        };

        const elements = {
            inputView: document.getElementById('input-view'),
            loadingView: document.getElementById('loading-view'),
            resultView: document.getElementById('result-view'),
            form: document.getElementById('love-form'),
            btn: document.getElementById('analyze-btn'),
            btnText: document.getElementById('btn-text'),
            loadingText: document.getElementById('loading-text')
        };
        
        // Predefined classes to avoid dynamic string construction failure
        const predictions = {
            categories: [
                { min: 90, label: "Twin Flames ðŸ”¥", style: "bg-rose-500/20 border-rose-500/30 text-rose-200" },
                { min: 80, label: "Soulmates ðŸ’–", style: "bg-pink-500/20 border-pink-500/30 text-pink-200" },
                { min: 70, label: "Power Couple âœ¨", style: "bg-purple-500/20 border-purple-500/30 text-purple-200" },
                { min: 50, label: "Good Vibes ðŸŒŠ", style: "bg-indigo-500/20 border-indigo-500/30 text-indigo-200" },
                { min: 0, label: "Just Friends ðŸ¤", style: "bg-slate-700/50 border-slate-600/30 text-slate-300" }
            ],
            quotes: [
                "The universe has conspired to bring you two together.",
                "A connection written in the stars, destined to shine.",
                "Two hearts beating to the same cosmic rhythm.",
                "Chemistry so strong it defies the laws of physics.",
                "A beautiful journey awaits those who walk together."
            ],
            marriage: ["In 6 Months", "In 1 Year", "In 2 Years", "In 3 Years", "Maybe Later", "Destiny Decides"],
            family: ["1 Kid & Dog", "2 Kids & Cat", "3 Kids", "No Kids, Just Pets", "Large Family", "Travel Couple"]
        };

        const audioSys = {
            init: () => {
                if (!state.audioCtx) {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    state.audioCtx = new AudioContext();
                }
            },
            play: (type) => {
                if (!state.audioEnabled) return;
                audioSys.init();
                const now = state.audioCtx.currentTime;
                const osc = state.audioCtx.createOscillator();
                const gain = state.audioCtx.createGain();

                if (type === 'click') {
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(600, now);
                    osc.frequency.exponentialRampToValueAtTime(300, now + 0.1);
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                    osc.start(now);
                    osc.stop(now + 0.1);
                    osc.connect(gain);
                    gain.connect(state.audioCtx.destination);
                } else if (type === 'error') {
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(150, now);
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.linearRampToValueAtTime(0, now + 0.3);
                    osc.start(now);
                    osc.stop(now + 0.3);
                    osc.connect(gain);
                    gain.connect(state.audioCtx.destination);
                } else if (type === 'success') {
                    [440, 554, 659].forEach((freq, i) => {
                        const osc2 = state.audioCtx.createOscillator();
                        const gain2 = state.audioCtx.createGain();
                        osc2.type = 'triangle';
                        osc2.frequency.value = freq;
                        gain2.gain.setValueAtTime(0, now);
                        gain2.gain.linearRampToValueAtTime(0.05, now + 0.1 + (i*0.05));
                        gain2.gain.exponentialRampToValueAtTime(0.001, now + 2);
                        osc2.connect(gain2);
                        gain2.connect(state.audioCtx.destination);
                        osc2.start(now);
                        osc2.stop(now + 2);
                    });
                }
            }
        };

        function toggleAudio() {
            state.audioEnabled = !state.audioEnabled;
            const icon = document.getElementById('sound-icon');
            const btn = document.getElementById('audio-btn');
            if (state.audioEnabled) {
                icon.setAttribute('icon', 'solar:volume-loud-linear');
                btn.classList.add('bg-rose-500/20', 'text-rose-400', 'border-rose-500/50');
                btn.classList.remove('text-slate-400', 'bg-slate-800/50');
                audioSys.play('click');
            } else {
                icon.setAttribute('icon', 'solar:volume-cross-linear');
                btn.classList.remove('bg-rose-500/20', 'text-rose-400', 'border-rose-500/50');
                btn.classList.add('text-slate-400', 'bg-slate-800/50');
            }
        }

        /* --- Core Logic Implemented via PRD --- */

        function handleCalculate(e) {
            e.preventDefault();
            
            // 1. Lock check
            if (state.isCalculating) return;

            const n1 = document.getElementById('name1').value.trim();
            const n2 = document.getElementById('name2').value.trim();

            // 2. Validation
            if (n1.length < 2 || n2.length < 2) {
                elements.form.classList.remove('shake-error');
                void elements.form.offsetWidth; // Force Reflow
                elements.form.classList.add('shake-error');
                audioSys.play('error');
                return;
            }

            // 3. Lock State
            state.isCalculating = true;
            state.name1 = n1.charAt(0).toUpperCase() + n1.slice(1);
            state.name2 = n2.charAt(0).toUpperCase() + n2.slice(1);

            // 4. Update Button UI
            elements.btn.disabled = true;
            elements.btnText.innerText = "Analyzing...";
            elements.btn.style.opacity = "0.7";
            elements.btn.style.cursor = "not-allowed";
            audioSys.play('click');

            // 5. Safe View Transition
            // Fade out input
            elements.inputView.classList.add('fade-out');
            
            setTimeout(() => {
                elements.inputView.classList.add('view-hidden');
                
                // Show loading
                elements.loadingView.classList.remove('hidden'); // Remove tailwind hidden
                elements.loadingView.classList.add('view-visible');
                
                // Trigger animation opacity
                requestAnimationFrame(() => {
                    elements.loadingView.classList.remove('opacity-0');
                    startSimulation();
                });
            }, 300);
        }

        function startSimulation() {
            const msgs = [
                "Analyzing pheromones...", 
                "Calculating compatibility...", 
                "Reading star charts...", 
                "Measuring heartbeat sync...",
                "Finalizing destiny..."
            ];
            let step = 0;

            // Clear any existing timers just in case
            if (state.simulationInterval) clearInterval(state.simulationInterval);
            if (state.fallbackTimeout) clearTimeout(state.fallbackTimeout);

            state.simulationInterval = setInterval(() => {
                elements.loadingText.style.opacity = 0;
                setTimeout(() => {
                    elements.loadingText.innerText = msgs[step % msgs.length];
                    elements.loadingText.style.opacity = 1;
                }, 150);
                if(state.audioEnabled) audioSys.play('click');
                step++;
            }, 800);

            // Fallback timeout guarantees results are shown
            state.fallbackTimeout = setTimeout(() => {
                finishSimulation();
            }, 3500);
        }

        function finishSimulation() {
            clearInterval(state.simulationInterval);
            clearTimeout(state.fallbackTimeout);
            showResults();
        }

        function showResults() {
            // Transition Loading -> Result
            elements.loadingView.classList.add('opacity-0');
            
            setTimeout(() => {
                elements.loadingView.classList.remove('view-visible');
                elements.loadingView.classList.add('hidden');
                
                elements.resultView.classList.remove('hidden');
                elements.resultView.classList.add('view-visible');
                requestAnimationFrame(() => {
                    elements.resultView.classList.remove('opacity-0');
                });

                // Compute Logic
                const seed = generateLoveHash(state.name1, state.name2);
                const score = 40 + (seed % 60);

                // Update DOM
                document.getElementById('res-name1').innerText = state.name1;
                document.getElementById('res-name2').innerText = state.name2;
                document.getElementById('quote-text').innerText = `"${predictions.quotes[seed % predictions.quotes.length]}"`;
                document.getElementById('marriage-pred').innerText = predictions.marriage[seed % predictions.marriage.length];
                document.getElementById('family-pred').innerText = predictions.family[seed % predictions.family.length];

                // Animate Score
                animateScore(score);

                if(score > 70) {
                    triggerConfetti();
                    audioSys.play('success');
                }

                // Unlock State safely at end of render cycle
                state.isCalculating = false;
                
                // Reset Button state for next time (even though hidden)
                elements.btn.disabled = false;
                elements.btnText.innerText = "Analyze Connection";
                elements.btn.style.opacity = "";
                elements.btn.style.cursor = "";

            }, 500);
        }

        function generateLoveHash(n1, n2) {
            const combined = (n1 + n2).toLowerCase().replace(/[^a-z]/g, '');
            let hash = 0;
            for (let i = 0; i < combined.length; i++) {
                hash = ((hash << 5) - hash) + combined.charCodeAt(i);
                hash |= 0;
            }
            return Math.abs(hash);
        }

        function animateScore(target) {
            const counter = document.getElementById('score-counter');
            const circle = document.getElementById('progress-circle');
            const catLabel = document.getElementById('score-category');
            
            const circumference = 264;
            circle.style.strokeDashoffset = circumference;
            
            let current = 0;
            const duration = 2000;
            const startTime = performance.now();

            function update(time) {
                const elapsed = time - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const ease = 1 - Math.pow(1 - progress, 4);
                
                current = Math.floor(target * ease);
                counter.innerText = current + '%';
                
                const offset = circumference - (current / 100) * circumference;
                circle.style.strokeDashoffset = offset;

                if (progress < 1) {
                    requestAnimationFrame(update);
                } else {
                    // Final Category Set
                    const cat = predictions.categories.find(c => target >= c.min) || predictions.categories[predictions.categories.length-1];
                    catLabel.innerText = cat.label;
                    // Apply static Tailwind classes from mapping
                    catLabel.className = `text-[10px] font-semibold mt-2 px-3 py-1 rounded-full uppercase tracking-wider border ${cat.style}`;
                }
            }
            requestAnimationFrame(update);
        }

        function resetApp() {
            document.getElementById('name1').value = '';
            document.getElementById('name2').value = '';
            
            elements.resultView.classList.add('opacity-0');
            
            setTimeout(() => {
                elements.resultView.classList.add('hidden');
                elements.resultView.classList.remove('view-visible');
                
                elements.inputView.classList.remove('view-hidden');
                // Force Reflow
                void elements.inputView.offsetWidth;
                elements.inputView.classList.remove('fade-out');
                
                audioSys.play('click');
            }, 300);
        }

        function shareResult() {
            const score = document.getElementById('score-counter').innerText;
            const text = `LoveMeter Pro Result: ${state.name1} & ${state.name2} have ${score} Compatibility! ðŸ’˜ Calculated via LoveMeter.`;
            navigator.clipboard.writeText(text).then(() => {
                const toast = document.getElementById('toast');
                toast.classList.remove('opacity-0', 'translate-y-[-20px]', 'pointer-events-none');
                audioSys.play('click');
                setTimeout(() => {
                    toast.classList.add('opacity-0', 'translate-y-[-20px]', 'pointer-events-none');
                }, 3000);
            });
        }

        // --- Visual Effects ---
        function initStars() {
            const container = document.getElementById('stars-container');
            for(let i=0; i<50; i++) {
                const star = document.createElement('div');
                const size = Math.random() * 2 + 1;
                star.style.width = size + 'px';
                star.style.height = size + 'px';
                star.style.background = 'white';
                star.style.position = 'absolute';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.borderRadius = '50%';
                star.style.opacity = Math.random() * 0.5;
                star.style.animation = `starry-twinkle ${Math.random() * 3 + 2}s infinite alternate`;
                container.appendChild(star);
            }
        }

        function createParticles() {
            const container = document.getElementById('particles');
            const colors = ['#f43f5e', '#ec4899', '#d946ef', '#8b5cf6'];
            
            setInterval(() => {
                if(document.hidden) return;
                const p = document.createElement('div');
                p.classList.add('heart-particle');
                p.innerHTML = `<iconify-icon icon="solar:heart-bold" width="${Math.random() * 14 + 8}"></iconify-icon>`;
                p.style.left = Math.random() * 100 + '%';
                p.style.color = colors[Math.floor(Math.random() * colors.length)];
                p.style.animationDuration = (Math.random() * 5 + 5) + 's';
                p.style.opacity = Math.random() * 0.3 + 0.1;
                container.appendChild(p);
                setTimeout(() => p.remove(), 10000);
            }, 600);
        }

        function triggerConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const particles = [];
            const colors = ['#f43f5e', '#e11d48', '#be123c', '#fb7185', '#d946ef'];
            
            for(let i=0; i<120; i++) {
                particles.push({
                    x: canvas.width / 2,
                    y: canvas.height / 2,
                    vx: (Math.random() - 0.5) * 15,
                    vy: (Math.random() - 0.5) * 15 - 5,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    size: Math.random() * 6 + 2,
                    life: 100
                });
            }

            function draw() {
                ctx.clearRect(0,0,canvas.width,canvas.height);
                let active = false;
                particles.forEach(p => {
                    if(p.life > 0) {
                        active = true;
                        p.x += p.vx;
                        p.y += p.vy;
                        p.vy += 0.3;
                        p.vx *= 0.96;
                        p.life--;
                        p.size *= 0.98;
                        ctx.fillStyle = p.color;
                        ctx.globalAlpha = p.life / 100;
                        ctx.beginPath();
                        ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
                        ctx.fill();
                    }
                });
                if(active) requestAnimationFrame(draw);
                else ctx.clearRect(0,0,canvas.width,canvas.height);
            }
            draw();
        }

        initStars();
        createParticles();

    </script>

</body></html>
